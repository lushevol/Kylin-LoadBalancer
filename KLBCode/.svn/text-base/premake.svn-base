#!/bin/bash

export LANG="en.utf-8"
TEMP=/tmp/pre.version.h
VERSION=src/share/version.h
echo "//This is generated by premake" > $TEMP
echo "#ifndef __VERSION_HEADER__" >> $TEMP
echo "#define __VERSION_HEADER__" >> $TEMP
cat src/share/version >> $TEMP
svn info > /dev/null 2> /dev/null
if [ $? == 0 ]; then
  svn info 2>/dev/null | grep Rev: | awk '{print $4;}' >> $TEMP
else
  echo 0 >> $TEMP
fi
echo "#endif" >> $TEMP
diff $TEMP $VERSION > /dev/null 2> /dev/null
if [ $? != 0 ]; then
  rm -f $VERSION 2> /dev/null
  cp $TEMP $VERSION
fi

ln -n -s ../xml src/rpc/xml 2>/dev/null

ln -n -s ../rpc src/server/rpc 2>/dev/null
ln -n -s ../rpc src/client/rpc 2>/dev/null
ln -n -s ../rpc src/model/rpc 2>/dev/null

ln -n -s ../share src/model/share 2>/dev/null
ln -n -s ../share src/server/share 2>/dev/null
ln -n -s ../share src/client/share 2>/dev/null
ln -n -s ../share src/cipher/share 2>/dev/null
ln -n -s ../share src/package/share 2>/dev/null
ln -n -s ../share src/licence/share 2>/dev/null
ln -n -s ../share src/route/share 2>/dev/null

ln -n -s ../model src/server/model 2>/dev/null
ln -n -s ../model src/client/model 2>/dev/null

ln -n -s ../cipher src/server/cipher 2>/dev/null
ln -n -s ../cipher src/package/cipher 2>/dev/null
ln -n -s ../cipher src/licence/cipher 2>/dev/null

ln -n -s ../licence src/server/licence 2>/dev/null
ln -n -s ../licence src/package/licence 2>/dev/null

exit 0
